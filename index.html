<!DOCTYPE html>
<html>
<head>
    <title>–®–∞—É—Ä–º–∞ –ò–º–ø–µ—Ä–∏—è v1.3.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(45deg, #ff6b35, #f7931e); 
            color: white; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh; overflow: hidden;
        }
        #header { 
            position: fixed; top: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.9); padding: 10px; text-align: center; 
            font-size: 14px; z-index: 100;
        }
        #reset-btn { 
            position: fixed; top: 10px; right: 10px; 
            background: #ff4444; color: white; padding: 8px 12px; 
            border-radius: 20px; cursor: pointer; font-size: 12px;
        }
        #debug { 
            position: fixed; top: 50px; left: 10px; 
            background: rgba(0,0,0,0.8); padding: 5px 10px; 
            border-radius: 10px; font-size: 12px; max-width: 300px;
        }
        #game { 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            height: 100vh; padding-top: 80px; padding-bottom: 120px;
        }
        #shaurma { 
            font-size: 80px; cursor: pointer; 
            transition: all 0.1s; user-select: none;
            margin-bottom: 20px;
        }
        #shaurma:active { transform: scale(0.9); }
        #stats { text-align: center; font-size: 24px; margin: 10px 0; }
        #upgrades { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.95); padding: 20px; 
            max-height: 35vh; overflow-y: auto;
        }
        .upgrade { 
            background: rgba(255,255,255,0.15); 
            margin: 8px 0; padding: 15px; 
            border-radius: 12px; cursor: pointer; 
            font-size: 16px; transition: all 0.2s;
            touch-action: manipulation;
        }
        .upgrade.ready { 
            background: rgba(255,215,0,0.4); 
            border: 2px solid #ffd700;
            animation: pulse 1s infinite; 
        }
        .upgrade.bought { background: rgba(0,255,0,0.3); border: 2px solid #00ff00; }
        .version { color: #ffd700; font-weight: bold; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>
    <div id="header">
        <span class="version">v1.3.0</span> | 
        <span id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <div id="reset-btn">üîÑ –°–ë–†–û–°–ò–¢–¨</div>
    <div id="debug"></div>
    
    <div id="game">
        <div id="shaurma">üßÜ</div>
        <div id="stats">
            <div id="count">0 üßÜ</div>
            <div id="dps">0/—Å–µ–∫</div>
            <div id="tap-power">–¢–∞–ø: x1</div>
        </div>
    </div>
    
    <!-- ‚úÖ –°–¢–ê–¢–ò–ß–ù–´–ï –ö–ù–û–ü–ö–ò ‚Äî –ù–ò–ö–û–ì–î–ê –ù–ï –õ–û–ú–ê–Æ–¢–°–Ø -->
    <div id="upgrades">
        <h3>üè™ –ê–ø–≥—Ä–µ–π–¥—ã</h3>
        <div id="tap-upgrade" class="upgrade">üëê –ë—ã—Å—Ç—Ä—ã–µ —Ä—É–∫–∏<br>–£—Ä. <span id="tap-level">0</span><br><span id="tap-cost">50</span> üßÜ</div>
        <div id="helper-upgrade" class="upgrade">ü§ñ –ü–æ–º–æ—â–Ω–∏–∫<br>–£—Ä. <span id="helper-level">0</span><br><span id="helper-cost">200</span> üßÜ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        // –î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ (–ø–æ—Å–ª–µ tg.ready()):
        const userId = tg.initDataUnsafe?.user?.id?.toString() || 'guest_' + Math.random().toString(36).slice(2);
        
        // ========== –ò–ì–†–ê ==========
        let game = {
            version: '1.3.0',
            shaurma: 0,
            dps: 0,
            tapPower: 1,
            tapLevel: 0,
            helperLevel: 0,
            tapCost: 50,
            helperCost: 200
        };

        // –≠–õ–ï–ú–ï–ù–¢–´
        const el = {
            shaurma: document.getElementById('shaurma'),
            count: document.getElementById('count'),
            dps: document.getElementById('dps'),
            tapPower: document.getElementById('tap-power'),
            tapLevel: document.getElementById('tap-level'),
            helperLevel: document.getElementById('helper-level'),
            tapCost: document.getElementById('tap-cost'),
            helperCost: document.getElementById('helper-cost'),
            tapUpgrade: document.getElementById('tap-upgrade'),
            helperUpgrade: document.getElementById('helper-upgrade'),
            status: document.getElementById('status'),
            debug: document.getElementById('debug'),
            reset: document.getElementById('reset-btn')
        };

        // ‚úÖ –õ–û–ê–î
        function load() {
            const saved = localStorage.getItem('shaurma_v1.3');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.version === '1.3.0') {
                        game = data;
                        el.status.textContent = '–ó–∞–≥—Ä—É–∂–µ–Ω–æ';
                        el.debug.textContent = `–î–∞–Ω–Ω—ã–µ: ${Math.floor(game.shaurma)} üßÜ`;
                        return;
                    }
                } catch(e) {}
            }
            reset();
            el.status.textContent = '–ù–æ–≤–∞—è –∏–≥—Ä–∞';
        }

        // ‚úÖ –°–ë–†–û–°
        function reset() {
            localStorage.removeItem('shaurma_v1.3');
            game = {
                version: '1.3.0',
                shaurma: 0,
                dps: 0,
                tapPower: 1,
                tapLevel: 0,
                helperLevel: 0,
                tapCost: 50,
                helperCost: 200
            };
            update();
            el.status.textContent = '–°–±—Ä–æ—à–µ–Ω–æ';
            el.debug.textContent = '–¶–µ–Ω—ã: 50/200';
        }

        // –ó–∞–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é update() –Ω–∞ —ç—Ç—É:
        async function update() {
            el.count.textContent = Math.floor(game.shaurma) + ' üßÜ';
            el.dps.textContent = game.dps + '/—Å–µ–∫';
            el.tapPower.textContent = '–¢–∞–ø: x' + game.tapPower;
            el.tapLevel.textContent = game.tapLevel;
            el.helperLevel.textContent = game.helperLevel;
            el.tapCost.textContent = game.tapCost;
            el.helperCost.textContent = game.helperCost;
        
            el.tapUpgrade.className = game.shaurma >= game.tapCost ? 'upgrade ready' : 'upgrade';
            el.helperUpgrade.className = game.shaurma >= game.helperCost ? 'upgrade ready' : 'upgrade';
        
            // üå•Ô∏è –û–ë–õ–ê–ö–û ‚Äî –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            try {
                await fetch('/api/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(game)
                });
                el.debug.textContent = `‚òÅÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–µ`;
            } catch(e) {
                el.debug.textContent = `–õ–æ–∫–∞–ª—å–Ω–æ (${Math.floor(game.shaurma)} üßÜ)`;
            }
            
            localStorage.setItem('shaurma_v1.3', JSON.stringify(game));
        }

        // ‚úÖ –¢–ê–ü
        el.shaurma.onclick = () => {
            game.shaurma += game.tapPower;
            update();
            tg.HapticFeedback.impactOccurred('light');
            el.shaurma.style.transform = 'scale(0.9)';
            setTimeout(() => el.shaurma.style.transform = '', 100);
        };

        // ‚úÖ –ü–ê–°–°–ò–í–ö–ê
        setInterval(() => {
            game.shaurma += game.dps;
            update();
        }, 1000);

        // ‚úÖ –ê–ü–ì–†–ï–ô–î–´ ‚Äî –°–¢–ê–¢–ò–ß–ù–´–ï –ö–ù–û–ü–ö–ò
        el.tapUpgrade.onclick = () => {
            if (game.shaurma >= game.tapCost) {
                game.shaurma -= game.tapCost;
                game.tapLevel++;
                game.tapPower++;
                game.tapCost = Math.floor(game.tapCost * 1.15);
                update();
                tg.HapticFeedback.notificationOccurred('success');
                el.debug.textContent = '–ö—É–ø–ª–µ–Ω —Ç–∞–ø-–∞–ø–≥—Ä–µ–π–¥!';
            }
        };

        el.helperUpgrade.onclick = () => {
            if (game.shaurma >= game.helperCost) {
                game.shaurma -= game.helperCost;
                game.helperLevel++;
                game.dps++;
                game.helperCost = Math.floor(game.helperCost * 1.2);
                update();
                tg.HapticFeedback.notificationOccurred('success');
                el.debug.textContent = '–ö—É–ø–ª–µ–Ω –ø–æ–º–æ—â–Ω–∏–∫!';
            }
        };

        // ‚úÖ –†–ï–°–ï–¢
        el.reset.onclick = reset;

        // ‚úÖ –°–¢–ê–†–¢
        load();
        update();
        
        console.log('‚úÖ v1.3.0 ‚Äî –°–¢–ê–¢–ò–ß–ù–´–ï –ö–ù–û–ü–ö–ò');
    </script>
</body>
</html>
