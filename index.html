<!DOCTYPE html>
<html>
<head>
    <title>–®–∞—É—Ä–º–∞ –ò–º–ø–µ—Ä–∏—è v1.0.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(45deg, #ff6b35, #f7931e); 
            color: white; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh; 
            overflow: hidden;
        }
        #header { 
            position: fixed; top: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.9); padding: 10px; text-align: center; 
            font-size: 14px; z-index: 100;
        }
        #game { 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            height: 100vh; padding-top: 50px; padding-bottom: 100px;
        }
        #shaurma { 
            font-size: 80px; cursor: pointer; 
            transition: all 0.1s; user-select: none;
            margin-bottom: 20px;
        }
        #shaurma:active { transform: scale(0.9); }
        #stats { text-align: center; font-size: 24px; margin: 10px 0; }
        #upgrades { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.95); padding: 20px; 
            max-height: 35vh; overflow-y: auto;
        }
        .upgrade { 
            background: rgba(255,255,255,0.15); 
            margin: 8px 0; padding: 15px; 
            border-radius: 12px; cursor: pointer; 
            font-size: 16px; transition: all 0.2s;
        }
        .upgrade:hover:not(.locked) { background: rgba(255,255,255,0.25); }
        .upgrade.locked { opacity: 0.4; cursor: not-allowed; }
        .upgrade.bought { background: rgba(0,255,0,0.3); }
        .version { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>
    <div id="header">
        <span class="version">v1.0.0</span> | 
        <span id="debug">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    
    <div id="game">
        <div id="shaurma">üßÜ</div>
        <div id="stats">
            <div id="count">0 üßÜ</div>
            <div id="dps">0/—Å–µ–∫</div>
        </div>
    </div>
    
    <div id="upgrades">
        <h3 style="margin-bottom: 15px;">üè™ –ê–ø–≥—Ä–µ–π–¥—ã</h3>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let gameData = {
            version: '1.0.0',
            shaurma: 0,
            dps: 0,
            tapPower: 1,
            upgrades: {
                tap: { level: 0, baseCost: 50 },
                helper: { level: 0, baseCost: 200 }
            },
            lastSave: Date.now()
        };

        const elements = {
            shaurma: document.getElementById('shaurma'),
            count: document.getElementById('count'),
            dps: document.getElementById('dps'),
            upgrades: document.getElementById('upgrades'),
            debug: document.getElementById('debug')
        };

        // üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–µ—Ä—Å–∏–∏
        function loadGame() {
            try {
                const saved = localStorage.getItem('shaurmaGame_v1');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.version === '1.0.0') {
                        gameData = parsed;
                        elements.debug.textContent = '–ó–∞–≥—Ä—É–∂–µ–Ω–æ v1.0.0';
                        return true;
                    }
                }
                // –ù–æ–≤–∞—è –∏–≥—Ä–∞
                resetGame();
                elements.debug.textContent = '–ù–æ–≤–∞—è –∏–≥—Ä–∞ v1.0.0';
                return false;
            } catch(e) {
                resetGame();
                elements.debug.textContent = '–°–±—Ä–æ—Å (–æ—à–∏–±–∫–∞)';
            }
        }

        // üîÑ –°–±—Ä–æ—Å
        function resetGame() {
            localStorage.removeItem('shaurmaGame_v1');
            gameData = {
                version: '1.0.0',
                shaurma: 0,
                dps: 0,
                tapPower: 1,
                upgrades: {
                    tap: { level: 0, baseCost: 50 },
                    helper: { level: 0, baseCost: 200 }
                },
                lastSave: Date.now()
            };
        }

        // üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        function saveGame() {
            localStorage.setItem('shaurmaGame_v1', JSON.stringify(gameData));
            gameData.lastSave = Date.now();
        }

        // üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        function updateDisplay() {
            elements.count.textContent = Math.floor(gameData.shaurma).toLocaleString() + ' üßÜ';
            elements.dps.textContent = Math.floor(gameData.dps).toLocaleString() + '/—Å–µ–∫';
            saveGame();
        }

        // üñ±Ô∏è –¢–∞–ø
        elements.shaurma.onclick = () => {
            gameData.shaurma += gameData.tapPower;
            updateDisplay();
            tg.HapticFeedback.impactOccurred('light');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const shaurma = elements.shaurma;
            shaurma.style.transform = 'scale(0.9)';
            setTimeout(() => shaurma.style.transform = 'scale(1)', 100);
        };

        // üí∞ –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
        setInterval(() => {
            gameData.shaurma += gameData.dps;
            updateDisplay();
        }, 1000);

        // üè™ –ê–ø–≥—Ä–µ–π–¥—ã
        function renderUpgrades() {
            const upgradesList = [
                {
                    id: 'tap',
                    emoji: 'üëê',
                    name: '–ë—ã—Å—Ç—Ä—ã–µ —Ä—É–∫–∏',
                    desc: `–£—Ä. ${gameData.upgrades.tap.level} (+${gameData.tapPower} –∑–∞ —Ç–∞–ø)`,
                    getCost: () => Math.floor(gameData.upgrades.tap.baseCost * Math.pow(1.15, gameData.upgrades.tap.level)),
                    buy: () => {
                        gameData.upgrades.tap.level++;
                        gameData.tapPower++;
                    }
                },
                {
                    id: 'helper',
                    emoji: 'ü§ñ',
                    name: '–ü–æ–º–æ—â–Ω–∏–∫',
                    desc: `–£—Ä. ${gameData.upgrades.helper.level} (+${gameData.dps} /—Å–µ–∫)`,
                    getCost: () => Math.floor(gameData.upgrades.helper.baseCost * Math.pow(1.2, gameData.upgrades.helper.level)),
                    buy: () => {
                        gameData.upgrades.helper.level++;
                        gameData.dps++;
                    }
                }
            ];

            elements.upgrades.innerHTML = '<h3 style="margin-bottom: 15px;">üè™ –ê–ø–≥—Ä–µ–π–¥—ã</h3>';
            
            upgradesList.forEach(upgrade => {
                const cost = upgrade.getCost();
                const canBuy = gameData.shaurma >= cost;
                
                const div = document.createElement('div');
                div.className = `upgrade ${canBuy ? '' : 'locked'} ${upgrade.id === 'tap' && gameData.upgrades.tap.level > 0 ? 'bought' : ''}`;
                div.innerHTML = `
                    <div style="font-size: 18px; margin-bottom: 5px;">${upgrade.emoji} ${upgrade.name}</div>
                    <div style="font-size: 14px; opacity: 0.8;">${upgrade.desc}</div>
                    <div style="font-size: 16px; margin-top: 8px;">${cost.toLocaleString()} üßÜ</div>
                `;
                
                div.onclick = () => {
                    if (canBuy) {
                        gameData.shaurma -= cost;
                        upgrade.buy();
                        updateDisplay();
                        renderUpgrades();
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                };
                
                elements.upgrades.appendChild(div);
            });
        }

        // üöÄ –ó–ê–ü–£–°–ö
        loadGame();
        updateDisplay();
        renderUpgrades();
        
        // DEBUG: –∫–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É = —Å–±—Ä–æ—Å
        document.getElementById('header').onclick = resetGame;
        
        console.log('‚úÖ –®–∞—É—Ä–º–∞ –ò–º–ø–µ—Ä–∏—è v1.0.0 –∑–∞–ø—É—â–µ–Ω–∞!');
    </script>
</body>
</html>
