<!DOCTYPE html>
<html>
<head>
    <title>–®–∞—É—Ä–º–∞ –ò–º–ø–µ—Ä–∏—è v1.1.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(45deg, #ff6b35, #f7931e); 
            color: white; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh; overflow: hidden;
        }
        #header { 
            position: fixed; top: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.9); padding: 10px; text-align: center; 
            font-size: 14px; z-index: 100;
        }
        #reset-btn { 
            position: fixed; top: 10px; right: 10px; 
            background: #ff4444; color: white; padding: 8px 12px; 
            border-radius: 20px; cursor: pointer; font-size: 12px;
        }
        #game { 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            height: 100vh; padding-top: 60px; padding-bottom: 120px;
        }
        #shaurma { 
            font-size: 80px; cursor: pointer; 
            transition: all 0.1s; user-select: none;
            margin-bottom: 20px;
        }
        #shaurma:active { transform: scale(0.9); }
        #stats { text-align: center; font-size: 24px; margin: 10px 0; }
        #upgrades { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.95); padding: 20px; 
            max-height: 35vh; overflow-y: auto;
        }
        .upgrade { 
            background: rgba(255,255,255,0.15); 
            margin: 8px 0; padding: 15px; 
            border-radius: 12px; cursor: pointer; 
            font-size: 16px; transition: all 0.2s;
        }
        .upgrade:not(.locked):hover { background: rgba(255,255,255,0.25); }
        .upgrade.locked { opacity: 0.4; cursor: not-allowed; }
        .upgrade.bought { background: rgba(0,255,0,0.3); border: 2px solid #00ff00; }
        .version { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>
    <div id="header">
        <span class="version">v1.1.0</span> | 
        <span id="debug">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <div id="reset-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</div>
    
    <div id="game">
        <div id="shaurma">üßÜ</div>
        <div id="stats">
            <div id="count">0 üßÜ</div>
            <div id="dps">0/—Å–µ–∫</div>
        </div>
    </div>
    
    <div id="upgrades">
        <h3 style="margin-bottom: 15px;">üè™ –ê–ø–≥—Ä–µ–π–¥—ã</h3>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï ==========
        let gameData = {
            version: '1.1.0',
            shaurma: 0,
            dps: 0,
            tapPower: 1,
            upgrades: {
                tap: { level: 0, baseCost: 50 },
                helper: { level: 0, baseCost: 200 }
            }
        };

        const elements = {
            shaurma: document.getElementById('shaurma'),
            count: document.getElementById('count'),
            dps: document.getElementById('dps'),
            upgrades: document.getElementById('upgrades'),
            debug: document.getElementById('debug'),
            reset: document.getElementById('reset-btn')
        };

        // ========== –§–£–ù–ö–¶–ò–ò ==========
        
        // –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        function loadGame() {
            try {
                const saved = localStorage.getItem('shaurma_v1.1');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.version === '1.1.0') {
                        gameData = parsed;
                        elements.debug.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${Math.floor(gameData.shaurma).toLocaleString()} üßÜ`;
                        return;
                    }
                }
            } catch(e) {}
            // –ù–æ–≤–∞—è –∏–≥—Ä–∞
            resetGame();
            elements.debug.textContent = '–ù–æ–≤–∞—è –∏–≥—Ä–∞ v1.1.0';
        }

        // ‚úÖ –ü–û–õ–ù–´–ô –°–ë–†–û–°
        function resetGame() {
            localStorage.removeItem('shaurma_v1.1');
            gameData = {
                version: '1.1.0',
                shaurma: 0,
                dps: 0,
                tapPower: 1,
                upgrades: {
                    tap: { level: 0, baseCost: 50 },    // ‚úÖ –ë–ê–ó–û–í–´–ï –¶–ï–ù–´
                    helper: { level: 0, baseCost: 200 } // ‚úÖ –ë–ê–ó–û–í–´–ï –¶–ï–ù–´
                }
            };
            updateDisplay();
            renderUpgrades();
            elements.debug.textContent = '‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–æ!';
            tg.HapticFeedback.notificationOccurred('error');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        function saveGame() {
            localStorage.setItem('shaurma_v1.1', JSON.stringify(gameData));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        function updateDisplay() {
            elements.count.textContent = Math.floor(gameData.shaurma).toLocaleString() + ' üßÜ';
            elements.dps.textContent = Math.floor(gameData.dps).toLocaleString() + '/—Å–µ–∫';
            saveGame();
        }

        // üñ±Ô∏è –¢–ê–ü–´
        elements.shaurma.onclick = () => {
            gameData.shaurma += gameData.tapPower;
            updateDisplay();
            tg.HapticFeedback.impactOccurred('light');
            elements.shaurma.style.transform = 'scale(0.9)';
            setTimeout(() => elements.shaurma.style.transform = 'scale(1)', 100);
        };

        // üí∞ –ü–ê–°–°–ò–í–ö–ê
        setInterval(() => {
            gameData.shaurma += gameData.dps;
            updateDisplay();
        }, 1000);

        // üè™ –ê–ü–ì–†–ï–ô–î–´ ‚Äî ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ú–ò–ì–û–í–û–ô
        function renderUpgrades() {
            const upgrades = [
                {
                    id: 'tap',
                    emoji: 'üëê',
                    name: '–ë—ã—Å—Ç—Ä—ã–µ —Ä—É–∫–∏',
                    getCost: () => Math.floor(gameData.upgrades.tap.baseCost * Math.pow(1.15, gameData.upgrades.tap.level)),
                    buy: () => {
                        gameData.upgrades.tap.level++;
                        gameData.tapPower++;
                    }
                },
                {
                    id: 'helper',
                    emoji: 'ü§ñ',
                    name: '–ü–æ–º–æ—â–Ω–∏–∫',
                    getCost: () => Math.floor(gameData.upgrades.helper.baseCost * Math.pow(1.2, gameData.upgrades.helper.level)),
                    buy: () => {
                        gameData.upgrades.helper.level++;
                        gameData.dps++;
                    }
                }
            ];

            elements.upgrades.innerHTML = '<h3 style="margin-bottom: 15px;">üè™ –ê–ø–≥—Ä–µ–π–¥—ã</h3>';
            
            upgrades.forEach(upgrade => {
                const cost = upgrade.getCost();
                const canBuy = gameData.shaurma >= cost;
                
                const div = document.createElement('div');
                div.className = `upgrade ${canBuy ? '' : 'locked'} ${upgrade.id === 'tap' && gameData.upgrades.tap.level > 0 ? 'bought' : ''}`;
                div.innerHTML = `
                    <div style="font-size: 18px; margin-bottom: 5px;">${upgrade.emoji} ${upgrade.name}</div>
                    <div style="font-size: 14px; opacity: 0.8;">
                        –£—Ä. ${upgrade.id === 'tap' ? gameData.upgrades.tap.level : gameData.upgrades.helper.level}
                    </div>
                    <div style="font-size: 16px; margin-top: 8px; color: ${canBuy ? '#ffd700' : '#888'};">
                        ${cost.toLocaleString()} üßÜ
                    </div>
                `;
                
                div.onclick = () => {
                    if (canBuy) {
                        gameData.shaurma -= cost;
                        upgrade.buy();
                        updateDisplay();
                        renderUpgrades();
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                };
                
                elements.upgrades.appendChild(div);
            });
        }

        // –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê
        elements.reset.onclick = resetGame;

        // üöÄ –ó–ê–ü–£–°–ö
        loadGame();
        updateDisplay();
        renderUpgrades();
        
        console.log('‚úÖ v1.1.0 –∑–∞–ø—É—â–µ–Ω–∞!');
    </script>
</body>
</html>
